package main

import (
	"container/heap"
	"fmt"
	"go-aoc-2025/utils"
	"log"
	"maps"
	"slices"
	"strings"
)

func ExampleDayN() {
	fmt.Println("part 1:", part1(inputs[0]))
	fmt.Println("part 1:", part1(inputs[1]))
	fmt.Println("part 1:", part1(inputs[2]))
	fmt.Println()
	fmt.Println("part 2:", part2(inputs[0]))
	fmt.Println("part 2:", part2(inputs[1]))
	fmt.Println("part 2:", part2(inputs[2])) // Outputs 655?

	// Output:
	// part 1: 7036
	// part 1: 11048
	// part 1: 134588
	//
	// part 2: 45
	// part 2: 64
	// part 2: 631
}

func part1(input string) int {
	return solve(parse(input)).score()
}

func display(grid map[Point]rune) {
	maxX := 0
	maxY := 0
	for p := range grid {
		maxX = max(maxX, p.X)
		maxY = max(maxY, p.Y)
	}
	for y := 0; y <= maxY; y++ {
		for x := 0; x <= maxX; x++ {
			fmt.Print(string(grid[MakePoint(x, y)]))
		}
		fmt.Println()
	}
}

func part2(input string) int {
	grid, start, end := parse(input)
	sol := solve(grid, start, end)

	last := end
	// We skip the last one because it can have multiple paths leading to it.
	end = sol.hist[len(sol.hist)-2]
	dist := sol.steps() - 1

	visited := make(map[cacheKey]int)
	var states []*state
	pq := &PriorityQueue{items: make([]*state, 1)}
	pq.items[0] = &state{start, utils.Right, 0, []Point{start}, nil}
	heap.Init(pq)
	for pq.Len() > 0 {
		h := heap.Pop(pq).(*state)
		if h.pos == end {
			states = append(states, h)
			continue
		}
		key := cacheKey{h.pos, h.dir}
		if _, ok := visited[key]; !ok {
			visited[key] = h.score()
		}
		if visited[key] < h.score() {
			continue
		}
		visited[key] = h.score()
		if grid[h.pos] != '.' {
			continue
		}

		heap.Push(pq, h.clockwise())
		heap.Push(pq, h.anticlockwise())
		heap.Push(pq, h.move())
	}

	unique := make(map[Point]bool)
	unique[last] = true
	for _, s := range states {
		if s.steps() != dist {
			continue
		}
		for _, p := range s.hist {
			unique[p] = true
		}
	}

	return len(unique)
}

func part2_old(input string) int {
	grid, start, end := parse(input)
	sol := solve(grid, start, end)
	// Find all junctions first.
	var junctions []Point
	for _, p := range sol.hist {
		if p == start || p == end {
			continue
		}
		var count int
		for _, dir := range utils.All {
			if grid[p.Add(dir)] == '.' {
				count++
			}
		}
		if count > 2 {
			junctions = append(junctions, p)
		}
	}

	unique := make(map[Point]bool)
	for i, p := range junctions {
		for j := i + 1; j < len(junctions); j++ {
			log.Println(i, "of", len(junctions), j, "of", len(junctions))
			q := junctions[j]
			s := slices.Index(sol.hist, p)
			e := slices.Index(sol.hist, q)
			d := e - s
			r := solve(grid, p, q)
			if r.steps() != d {
				continue
			}
			for _, p := range r.hist {
				unique[p] = true
			}
		}
	}

	for _, p := range junctions {
		unique[p] = true
	}
	for _, p := range sol.hist {
		unique[p] = true
	}
	for p := range unique {
		grid[p] = 'o'
	}
	display(grid)
	return len(unique)
}

func parse(input string) (grid map[Point]rune, start, end Point) {
	grid = make(map[Point]rune)
	for y, row := range strings.Split(input, "\n") {
		for x, ch := range row {
			p := MakePoint(x, y)
			if ch == 'S' {
				start = p
				ch = '.'
			} else if ch == 'E' {
				end = p
				ch = '.'
			}
			grid[p] = ch
		}
	}
	return
}

func solve(grid map[Point]rune, start, end Point) *state {
	visited := make(map[cacheKey]bool)
	pq := &PriorityQueue{items: make([]*state, 1)}
	pq.items[0] = &state{start, utils.Right, 0, []Point{start}, nil}
	heap.Init(pq)
	for pq.Len() > 0 {
		h := heap.Pop(pq).(*state)
		if h.pos == end {
			return h
		}
		key := cacheKey{h.pos, h.dir}
		if visited[key] {
			continue
		}
		visited[key] = true
		if grid[h.pos] != '.' {
			continue
		}

		heap.Push(pq, h.clockwise())
		heap.Push(pq, h.anticlockwise())
		heap.Push(pq, h.move())
	}
	return nil
}

type Point = utils.Point

var MakePoint = utils.MakePoint

type cacheKey struct {
	pos, dir Point
}

type state struct {
	pos   Point
	dir   Point
	rot   int
	hist  []Point
	cache map[cacheKey]bool
}

func (s *state) clone() *state {
	return &state{
		pos:   s.pos,
		dir:   s.dir,
		rot:   s.rot,
		hist:  slices.Clone(s.hist),
		cache: maps.Clone(s.cache),
	}
}

func (s *state) move() *state {
	n := s.clone()
	n.pos = n.pos.Add(n.dir)
	n.hist = append(n.hist, n.pos)
	return n
}
func (s *state) anticlockwise() *state {
	n := s.clone()
	n.rot++
	n.dir = n.dir.Rotate('a')
	return n
}
func (s *state) clockwise() *state {
	n := s.clone()
	n.rot++
	n.dir = n.dir.Rotate('c')
	return n
}

func (s *state) steps() int {
	return len(s.hist) - 1 // Exclude the start point.
}

func (s *state) score() int {
	return s.steps() + s.rot*1000
}

// A PriorityQueue implements heap.Interface and holds Items.
type PriorityQueue struct {
	items []*state
}

func (pq PriorityQueue) Len() int { return len(pq.items) }

func (pq PriorityQueue) Less(i, j int) bool {
	// We want Pop to give us the highest, not lowest, priority so we use greater than here.
	return pq.items[i].score() < pq.items[j].score()
}

func (pq PriorityQueue) Swap(i, j int) {
	pq.items[i], pq.items[j] = pq.items[j], pq.items[i]
}

func (pq *PriorityQueue) Push(x any) {
	item := x.(*state)
	pq.items = append(pq.items, item)
}

func (pq *PriorityQueue) Pop() any {
	old := pq.items
	n := len(old)
	item := old[n-1]
	old[n-1] = nil // don't stop the GC from reclaiming the item eventually
	pq.items = old[0 : n-1]
	return item
}

var inputs = []string{
	`###############
#.......#....E#
#.#.###.#.###.#
#.....#.#...#.#
#.###.#####.#.#
#.#.#.......#.#
#.#.#####.###.#
#...........#.#
###.#.#####.#.#
#...#.....#.#.#
#.#.#.###.#.#.#
#.....#...#.#.#
#.###.#.#.#.#.#
#S..#.....#...#
###############`,
	`#################
#...#...#...#..E#
#.#.#.#.#.#.#.#.#
#.#.#.#...#...#.#
#.#.#.#.###.#.#.#
#...#.#.#.....#.#
#.#.#.#.#.#####.#
#.#...#.#.#.....#
#.#.#####.#.###.#
#.#.#.......#...#
#.#.###.#####.###
#.#.#...#.....#.#
#.#.#.#####.###.#
#.#.#.........#.#
#.#.#.#########.#
#S#.............#
#################`,
	`#############################################################################################################################################
#.....#.......#.............#.........#.......................#.......#...#...............#.....#.#.................................#.#....E#
#.#####.###.###.#######.###.#.#.#######.#.###.#####.###.#######.#.###.###.#.#####.#####.###.#.#.#.#.#####.###.#.###.#######.###.#.#.#.#.#.#.#
#.......#...#...#.....#.#.#.#.#.#...#...#.....#...#.#...#.......#...#.#...#...#...#.#...#...............#...#...#.#.......#.#...#.#.#...#.#.#
#########.#.#.###.#####.#.#.#.#.#.#.#.#########.#.#.###.#.#########.#.#.#.#.###.#.#.#.###.###.#####.###.###.#.#.#.###.###.#.#.###.#.#.###.#.#
#.......#.#.#.#...#...#.#.#.#.#...#.....#.......#.#...#.#.#...#...#.#...#.#.#...#.....#...#.#...#...#.....#.#.....#.....#.#...#...#.#.#...#.#
#.#####.#.###.#.#.#.#.#.#.#.###########.#######.#.###.#.#.###.#.#.#.#.#####.#.###.###.#.###.###.#.###.#.###.#.#.#.#.#.#.#.#.#.#.###.###.#####
#...#...#.......#.#.#...#.#...........................#.#.#...#.#...#.#.....#.#.....#.#...#...#.....................#.#.#...................#
#.#.#.#######.#####.#####.###########.#######.#####.#.###.#.###.#######.#####.###.#.#.###.#.#.#.#.#######.###.#.#####.#.#.#.#.###.###.#.###.#
#.#...#.....#.#...#...#.......#.......#.....#...#...#.....#.#...#.....#...#...#.....#...#...#.#...#.......#...#.#...#.#.#.#.#...#.#...#...#.#
#.#.###.###.###.#.#.#.###.###.#.#.#####.###.###.#.#########.#.###.###.###.#.###.#.###.#######.#####.#######.#.#.#.#.#.###.###.#.#.#.#######.#
#.#.....#.......#.#.#...#.#...#.#...#...#.#.#.#.#.......#...#...#...#.......................#...#.#.#.....#.#.....#.#.........#...#.#.....#.#
#.###.###########.#####.#.#####.#.#.#.#.#.#.#.#.###.###.#.#.###.###.#########.###.#.#.#.###.#.#.#.#.#####.#.#.#.#####.#######.#####.#.###.#.#
#...#...................#.....#.#.#.#.#.#.....#.....#.#...#.#.#...#.....#...#.....#.#.#.#.#.....#.#.....#.#...#.#.........#...........#.....#
#.#.#.#.###.#.###############.#.#.#.#.#.#############.#####.#.###.#####.#.#.#####.#.#.#.#.#######.#####.#.###.#.#.###.###.#.#.###.###########
#.#.#.#.#.#.#.#.....#.......#.#...#...#...............#...#...#.#...#...#.#.......#.#.#.#.......#...#...#.....#.#.#.......#.#...#.#.........#
#.#.###.#.#.###.###.###.#.#.#.###.#.#####.###.###.###.#.#.###.#.#.###.###.###.###.#.#.#.###.###.###.#.###.#####.#.#.#.###.#.#.#.###.#######.#
#.#.....#.#...#.#.#...#.#.#.#...#.#.#...#...#...#...#...#...#...#.....#...#...#.......#.....#.#.....#...#.......#...#.#...#...#...#.#.#.....#
#.#######.###.#.#.###.#.#.#.#.#.#.###.#.#####.#.#.#.#########.#.#######.#.#.#.#.#############.#####.###.#########.#####.###.#####.#.#.#.#.###
#.#.......#.#.....#...#.#.#...#.#.#...#.....#.#.#.#.........#.#.........#.#.#.#.#.................#.#.#...#.......#.........#...#...#.#.....#
#.#.#####.#.#######.#####.#######.#.#####.#.###.#.#########.#.#.#########.#.#.#.###.#######.#.#####.#.###.#.#######.#.###.###.#.#####.###.#.#
#.#.....#.......#...#...#...#.....#.#...........#.#.......#...#.#...#.....#.#.#...#.#.......#.#...#...#...#.....#...#...#.#.................#
#.#####.#######.#.###.#.###.#.#####.#######.#####.#.#.###.#####.#.#.###.###.#.###.###.#####.###.#.###.#.#######.#.#####.#.#####.#.#.###.#.#.#
#.#...#.#.....#...#...#...#.#.......#.....#.#.....#.#...#.#...#.#.#...#.#...#.#.#...#.#...#.#...#...#.#.........#.....#.#.......#...#...#.#.#
#.#.#.#.#.###.#.###.#####.#.#.#####.#.###.###.#########.###.#.#.#.###.#.#.###.#.###.#.#.#.###.###.###.###############.#.###########.#.###.#.#
#.#.#.#.#.#.....#...#...#...#.....#...#.#...#.#...#...#.#...#.#...#...#.#.#.#.#.........#.#...#.#.....#.......#.......#.........#...#.#.....#
#.#.#.#.#.#######.###.#.#.#.#####.###.#.###.#.#.#.#.#.#.#.###.#####.#####.#.#.#########.#.#.###.#######.#######.###############.#.###.#.#.###
#.#.#...#.........#...#.#.#.....#...#...#.#.....#...#...#.#.#...#...#.....#.#.....#.....#...#.....#.....#.....#...#...#...#.....#...#.#.#...#
#.#.#########.#######.#.#.#.###.###.###.#.###########.###.#.###.#.###.#.###.#####.#.#########.#.#.###.#.#.###.#.#.#.#.#.#.#.#######.#.#.#.#.#
#...#...#...#.......#.#.#.#.#.....#.......#...#.....#.#...#...#.#...#...#.......#...#.....#...#.#.....#.#...#...#...#...#...#...............#
###.#.#.#.#.#######.#.#.#.#.#.#######.#####.#.#.###.###.###.###.#.#.###.#.#.#.#.#####.#.###.###.###.#######.#####.###########.#.###.#.#######
#...#.#...#...#...#...#.#.#.#.......#.....#.#.....#.....#...#...#.#...#...#.#...#.....#...#...#.#.........#.....#.........#...#.....#...#...#
#.#.#.#######.###.#####.#.#.#######.#####.#.#####.#######.#.#.#######.#.###.#.###.#.###.#.###.#.#.#######.#####.#.#######.#.#####.#####.#.#.#
#.#...#.....#...#.....#...#...#...#.....#...#...#.#...#...#...........#.....#.#...#...#.#.....#...#.#...#.#...#...#.....#.#.#.....#...#...#.#
#.#.###.###.###.#.###.#.#.###.#.###.#########.#.#.#.#.#.#####.#.#########.#.#.###.###.###########.#.#.#.#.#.#.###.###.#.#.#.#.###.#.#.#####.#
#.#.#...#.#...#.....#...#.#.#...#...#.........#.#...#.#...#...#.....#...#...#...#...#...........#...#.#.#...#...#...#.#...#.......#.#.......#
#.#.#.###.###.#####.#.###.#.###.#.###.#####.###.###.#.###.#.#.###.#.#.#.#######.#.#.###########.#####.#.#####.#.###.#.###########.#.#########
#.#.#.#.....#.#...#.#...#.#.#...#.....#...#.#...#.....#...#.#.....#...#...#...#.#.#.....#...#...#.....#.........#...#.......#.....#.........#
#.#.#.#####.#.###.#.#####.#.#.#########.###.#.#.#.###.#.###.###########.#.#.###.#.#####.#.#.#.###.#########.#####.#########.#####.#########.#
#.#.#.#.....#...#.#.....#.............#...#.#...#.#...#...#.......#.#...#.#.#...#.....#.#...#.#...#.........#.....#.............#...#.......#
###.#.#.#######.#.#####.#.#.#####.###.###.#.#.###.#.#####.#######.#.#.###.#.#.#########.###.#.#.###.#####.#.#.#####.#.#########.#.###.#.###.#
#...#.#.......#...#.....#.#.#.......#.....#.#.....#.#.......#.......#.#.#...#.........#...#.#.#.....#.....#.#...#...#.........#.#.#...#...#.#
#.#.#.#.#####.###.#.#####.###.###.#.###.###.#######.#.#####.#.#####.#.#.###.#########.###.#.#.#.#####.#####.###.#####.#######.#.#.#.###.#.#.#
#.#...#.....#...#.#.#.........#...#.#...#...#.....#.#.#.....#...#...#.#.....#.......#.....#.#.#.....#...#...#.#.....#.#.#.........#.#.....#.#
#.#.#.###.#####.#.#.###.#######.###.#.###.#.#.###.###.###.#####.#.###.#.#####.###.#.#######.#.#####.#.#.#.###.#####.#.#.#.#####.#.#.#.#.#.#.#
#.#.#.#...#...#...#...........#.#.....#...#.#...#.....#...#.....#...#.#.....#.#.#.#.#.......#.......#.#.#...#...#...#...#...#...#...#...#.#.#
#.###.###.#.#.#.#.###.#######.#.#######.###.###.#######.###.#######.#.#####.#.#.#.###.###.#############.###.#.#.#.#####.###.#.###.###.#.###.#
#...#...#.#.#...#.....#...#.....#.......#.....#...#.....#...#.....#.#...#...#...#.......#...#...........#.#...#.#.....#...#.#...#.#...#.....#
#.#.#.#.###.###.#.#####.#.#######.###############.###.#.#.###.#.#.#.###.#.#####.###.###.###.#.#######.#.#.#####.#####.#.###.###.#.#####.###.#
#.#.#.#.....#...#.#.....#...#...#.#.............#.....#.#...#.#.#.....#.#.#...#...#.......#...#.......#.....#...#...#...#...#...#...........#
###.#########.#.#.#.#######.#.#.#.#.#########.#########.###.###.###.###.###.#.###.###.#.#######.###########.#.###.#.#####.###.###.#.#.#.#.###
#...#.....#...#.#.........#...#.#...#...#.#...#...........#...#.......#.....#...#...#.#...#.......#.....#...#...#.#.....#.#.#.#.....#...#...#
#.###.###.#.#####.#######.#####.#.###.#.#.#.###.#############.#####.#.#########.###.#####.#.#.###.#####.#.#####.#.#######.#.#.#########.###.#
#.#...#.....#.....#...#...#...#.#.#...#...#.....#.............#...#.#...#.....#...#...#...#.....#.....#.......#.#.#.......#.#.#...........#.#
#.#.#######.#.#####.#.#.###.#.#.#.#.#.###########.#############.#.###.#.#.###.###.###.#.#.#.###.#####.#########.#.#.#######.#.#.#######.#.#.#
#.........#.#...#.#.#.#.#.#.#...#...#.............#.....#.......#.#...#.#.#.#...#.....#.#.#...#.......#.......#...#.#.......#.#.......#.#...#
#.#######.#.###.#.#.#.#.#.#.###.#####.#############.#.###.#.#####.#.###.#.#.###.#######.#####.#######.#.###.#.#.###.#.#####.#.#.#####.#.#.###
#...#.....#.#...#.#.#...#.#...#.#...#.#.......#.....#.....#...#...#.#...#.#...#.#...............#.....#...#.#...#...#.....#.#.#...#...#.....#
#.#.#.#######.###.#.#####.###.###.#.#.#.#.#.#.#.#############.#.###.#.###.###.#.#.#####.#.#.#.#.###.#####.#.#####.###.###.###.###.#.###.#.###
#.#.#.......#...#.#.#.......#.#...#...#...#.#.#...#.....#.....#.#...#...#...#.....#.#...#.#.#.#.......#...#.#.....#.#.#...#...#...#.#.......#
###.#.#####.###.#.#.#.#.#####.#.#########.#.#.###.#.#.###.#####.#.#####.###.#.#####.#.###.#.#####.#.#.#.###.#.#####.#.#.#.#.#######.#.#.#.#.#
#...#.....#...#...#.#.#...#...#.#.......#.#.#...#.....#...#...#.#...#.#.....#.#...#.....#.#.#.....#...#.....#...#...#.#.#.#.#.......#...#.#.#
#.#.#########.###.#.#.###.#.#.#.#.###.###.#.###.#####.#.#####.#.#.#.#.###.#####.#.#######.#.#.#####.#######.###.###.#.#.#.#.#.#########.#.#.#
#.#.........#...#.#.#...#.#.....#...#.....#...#.....#.#.#.....#.#.#.#.....#.....#...#.....#...#...#.#.......#.......#.#.....#.....#.......#.#
#.#.#######.###.#.#.#####.#######.#.#########.#####.###.###.###.#.#.###.###.#######.#.#.#######.#.#.#.#.#.###.###.###.#######.###.###.#.#.#.#
#.#...#...#...#...#.......#.......#.....#.........#...#...#...#.#.#...#.#.#...#...#...#.......#.#.#...#.#.#.#.#.....#.#.......#.............#
#.###.#.#.###.###########.#.###########.#.#.#####.###.#.#.#.#.#.#.###.#.#.###.#.#.#.###.#.###.###.#.###.#.#.#.#####.#.###.#####.###.#.#.#####
#...#...#.#.#.#...#.....#.#...#...........#.......#...#.#.#.#...#...#.#...#...#.#...#.....#.....#.......#...#...........#.#.......#.#...#...#
#.#.#####.#.#.#.#.#.###.#.###.#####.#######.#.#####.###.#.###.#####.#.#####.#########.#####.###.#######.###.###.#.#.###.#.#.#####.#.#.###.#.#
#.#.#.......#.#.#...#...#...#...#...#.....#.#.......#...#...#...#...#.#...#...#...#...#.......#...#.....#...#...#.#...#.#...#...#.#.#.....#.#
#.#.#.#######.#.#####.#####.###.#.#.#.###.#.#############.#.###.#.###.#.#.#.#.#.#.#.#####.###.###.#######.###.###.#####.#####.#.#.#.#.#####.#
#.#.#.#.#.....#.#...#.....#...#.#...#...#.#...#...........#.#...#...#.#.#.#.#...#...#...#.#.#...#...........#...#...#...#.....#.#.#.#.#...#.#
#.#.#.#.#.#####.#.#.#####.###.#.#.#.###.#.###.#.#.#####.###.#.#######.###.#.#####.#.#.#.#.#.###.###########.###.###.#.###.#####.#.#.#.###.#.#
#.#.....#...#...#.#...#...#...#.#.#...#.#.....#...#...#.#...#.........#...#.#.#...#...#.#.#.......#.......#...#...#.#.#.#.#...#...#.#.....#.#
###########.#.###.#.###.#.#.###.#.###.#.#######.#.###.#.#.###.#########.#.#.#.#.#######.#.#.#.#####.#####.###.###.#.#.#.#.#.#.#####.#######.#
#.........#.......#.#...#.#.....#...#.#...#...#.#.#...#.#.#...#.......#.#...#.#.#.........#.....#...#.....#.....#.#...#...#.#.#.....#.......#
#.#######.###########.#.#.#######.###.###.#.#.###.#.###.#.###.#.#####.#.###.#.#.#.#########.#.###.###.#########.#.###.#####.#.#.#####.#.#####
#.................#...#.#...#.....#...#...#.#.....#.#...#...#.#.#.....#...#...#...#...#.#.....#...#...#.......#.#...#.......#...#.#...#.#...#
#.#.#.#.###.###.#.#.###.#.###.#####.#.#.###.#######.#.#####.###.#.###.###.###.#####.#.#.#.#####.###.#.#.#.###.###.#.#############.#.#.###.#.#
#...#.#...#...#.#...#...............#.#.#.....#.....#.....#.#...#...#.#.#.#...#...#.#.#...#.....#.....#.#.#.#...#.#.#.....#.......#.#.....#.#
#.###.###.###.#.#.#.###.###.#####.#.#.#.###.#.#.#.#.#####.#.#.#####.#.#.#.#####.#.#.#.#####.#####.#######.#.###.###.#.#####.###.#.#.###.#.#.#
#...#.#.#.#...#...#...#...#.#.....#.#.#...#.#.#.#.#.....#.#...#...#.#...#.......#...#...#...#...#.#.......#...#...#.#.#...#...#.#.#.#...#.#.#
###.#.#.#.#.#.#####.#.#.###.#.###.#.#####.###.###.#######.#.###.#.#.###############.###.#.###.###.#####.###.#####.#.#.#.#.#.#.#.###.#.#.#.#.#
#...#.#.#...#.....#.#.#.#...#.#...#.....#.....#...#.......#.#...#...#.........#.......#...#.......#.....#.........#.#...#...#.#.....#.#...#.#
#.###.#.###.###.#.#.#.###.###.#######.#########.#.#.#######.#.#######.#######.#.###.#######.#######.#####.#########.#.#####.#.#######.#.###.#
#.#...#.....#...#...#.#...#.#.......#...........#.#.#.......#.#.......#...#...#...#.....#.#...#.#.....#...#.........#.......#.#.......#.#...#
###.#.#######.#######.#.###.#.#####.#.###.#.#####.#.#######.#.#.#####.###.#.#####.###.#.#.###.#.#.###.#.#######.#.###.#.###.#.#.#######.#.###
#...#.#.....#...#...#...#...#.#.#.....#.#.#.#...#.#...#...#.#.#.#.......#.#.....#...#.#.....#.#...#...#.......#.#.#...#.#...#...#.....#.#...#
#.#.###.###.###.#.#.#####.#.#.#.#.###.#.#.###.#.#####.#.#.#.#.#.#.#####.#.#####.###.#.#.#####.#.###.#########.###.#.###.#########.#####.###.#
#.#.#...#.....#.#.#.#...#.#.#...#.#.....#.....#.....#...#.#.#.#...#.#...#...#...#...#.#.#.....#.#...#...#.......#.#...#...........#.....#...#
#.###.###.###.#.#.#.#.#.###.###.#.#########.#####.#####.#.#.#.#####.#.#####.#.#.#.###.###.#######.###.###.#.###.#.#########.#######.#####.###
#.......#...#.#...#...#.#.....#.#.........#.....#.......#.#.#.......#.#.....#.#.#...#...#.#.......#...#...#...#.#.#...#.....#...........#...#
#.#####.###.###########.#.#####.#####.#.#.#.#.#.###.#####.###.#.###.#.#.#####.#####.###.#.#.#.#####.#.#.#.#.###.#.#.#.#.#####.#########.#.#.#
#.#...#...#.......#.....#...#.......#...#...#.#...#.#.........#.......#.....#.......#.#.....#.#.....#.....#.#...#.....#.#.......#.....#.#...#
###.#.###.#.###.###.#######.#.#############.#.#####.#.###############.#.###.#########.#.###.#.#############.#.#######.#.#.###.###.###.###.#.#
#...#...#.#.#...#...#.....#.#.#...........#.#.....#...#.#...#.......#.#...#.............#...#.......#.....#.#.........#.#...#.....#.....#.#.#
#.#####.#.#.#.###.###.###.#.#.#.#########.###.###.#####.#.#.#.#####.#.###.#######.#######.#########.#.###.#.###########.###.#.#.#######.#.#.#
#.....#.#.#.#...#.#.#...#.#...#.....#...#...#.#.........#.#...#...#.#.#.#.....................#.....#...#...#.....#.........#.#.#...#.....#.#
#.###.#.#.#.###.#.#.#.#.#.#########.#.#.###.###.#####.###.#####.#.#.#.#.#.#####.#############.#.###.#.#.###.#.#####.#########.###.#.#####.#.#
#.#...#.#...#...#.#...#.#...........#.#.........#.....#...#.....#.#.#.#.......#.#.......#...#...#.....#...#.#.#.........#...#.#...#...#...#.#
#.#.###.###.#.###.#.###.#############.###########.#.###.#####.###.#.#.#####.#.#.#.###.###.#.#.###.#####.#.#.#.#.#######.#.#.#.#.#####.###.#.#
#.#...#.......#...#...#.#.......#.....#.....#.....#.....#.....#...#...#...#.#.#.#.#...#...#.#.#...#...#.#...#...#...#...#.#.#.#.....#...#...#
#.###.#####.#.#.#######.#######.#.#####.###.#.#############.###.#######.#.###.#.#.###.#.###.#.#.###.#.#.#.#######.#.#.#####.#.#.#######.#.###
#...#...#...#.#.#.......#.......#...#.....#.#...#.........#.#...#.......#...#.....#.....#.#...#.#...#...#.......#.#.#.......#...#.......#...#
#######.###.#.#.###.#####.#####.###.#####.#####.#####.###.#.###.###.#.#####.#######.#####.#######.#############.#.#.#####.#.#####.#######.#.#
#.......#...#.#...#...........#.#...#.....#.....#...#.#...#...#...#.#...#...........#.....#.....#.#.....#.....#.#.#.#.......#.....#.....#...#
#.#######.#.#.###.#.#.#######.###.###.#####.#.###.#.#.#.#####.###.#####.#.###.#########.#.###.#.#.#.#####.#.###.#.#.#########.#####.###.#.###
#.....#.#.......#...#...#...#.....#...#.....#.....#...#.....#...#.......#.....#.........#.....#...#.......#...#.#.#.........#...#.....#.#.#.#
#.###.#.#.#.#########.#.#.#.#######.###.#######.###########.#.#.#################.#################.#########.#.#.#.#######.###.#.###.###.#.#
#.#.#.#.....#.........#.#.#.....#...#...#.............#...#...#.#.#.......#...............#.......#...#.#...#...#.#.#...#.#.#...#...#...#.#.#
#.#.#.###.###.###.#.#.#.#.###.#.#.#.#.#####.#######.#.#.#.###.#.#.#.###.#.#.#.#######.###.#.###.#####.#.#.#.#####.###.#.#.#.#.#######.#.#.#.#
#...#...#.#...#.#...#.#.#...#.....#.#.#.....#.....#.#...#...#.#.#.....#.#.#.#.#.......#.....#.#.....#.#...#.......#.....#...#.#.....#.#.#.#.#
#.#.###.#.#.###.#####.#.###########.#.#.#####.#.#.#.###.#.###.#.#####.#.#.###.#.###.#########.#.#.#.#.#.#######.#.#.###.#.###.#.#.#.###.#.#.#
#.#.....#.#.#.......#.......#.......#...#.....#.#...#.....#...#...#...#.#...#.#...#.#.......#...#.#.......#...#.#.#.#...#.#...#.#.......#...#
#.#.#.#####.#.#.#####.#####.#.#####.###.###.###.#####.#####.#####.#.###.###.#.#####.#.#####.#####.###.###.#.#.#.#.#.#.###.#.###.###########.#
#.#...#...#.#.#...#.......#...#...#.#.....#.#...#.....#...#.....#.#...#.#.#.#.....#.....#...#.....#...#.....#.#.#.#.#...#...#...#...#.....#.#
###.#.#.#.#.#####.#.###.#########.#.###.#.###.#.#######.#.###.#.#.#.###.#.#.#.###.#######.#.#.#####.#.#######.#.#.#.###.#######.#.#.#.###.#.#
#.....#.#...#...#.#...#.#.........#.....#...#.#.#.....#.#.....#...#...#.#.#.#.#.#.......#.#.........#.....#...#.......#.#.....#...#...#...#.#
#.#.###.#####.#.#.###.###.#####.#.#########.#.###.###.#.###.#.#####.#.#.#.#.#.#.#######.#.#.###.###.#####.###.#########.#.###.###.#####.###.#
#.#...#.#.....#...#.#...#...#...#.#.......#.#.#...#...#...#.#.....#.#...#.#.#...#.......#.#...#...#.#...#...#.#.......#...#.#.....#.....#...#
#.#.#.#.#.#######.#.###.###.#.###.###.#.###.#.#.###.###.###.#####.#.#####.#.###.#.#.#.###.###.###.#.#.#####.###.#####.#.###.#####.#.#####.###
#...#...#.....#.#.....#...#.#.#.#...#.#...#.#...#.#.....#...#...#...#.....#.#.....#.#.......#...#...#.....#.....#.....#...#.....#.#.........#
#.#.#####.###.#.#####.###.#.#.#.###.#####.#.#.#.#.#######.#####.#####.#.#.#.#.###.#.#.#####.###.#########.#######.#######.#.###.#.###########
#.#.....#...#.#.#.....#...#.#.#...........#.#...#.#.......#...........#.#.#.#...#...#.....#...#.#.......#...........#...#...#...#...........#
#.#.###.###.#.#.#.#####.###.#.#####.#######.#.###.#.#######.#########.###.#.#.###.#######.###.#.#.#.#.#.###.###.###.#.#######.###.#########.#
#...#...#.#.#.#.#.....#...#.#.#...#.#.....#.#.....#...#.............#.....#.#.....#.....#...#.#.#.#.#.........#.#...#.#.....#.#.....#.....#.#
###.#.###.#.#.#.#.#.#.###.#.#.#.#.#.#.###.#.#####.#.#.#.#####.#.###.###.###.#.#.###.#.#####.#.#.###.#########.#.#.#.#.#.#.#.#.###.#.#.#.###.#
#...#.#.................#.#.#...#.#.#...#.#.#.....#...#.#...#.#...#...#.#...#.#.#...#.....#.#.#...#.....#...#.#.......................#...#.#
#.#.#.#.#####.#.#.#.###.#.#.#.###.###.#.#.#.#.#####.###.###.#.#.#.###.###.#####.#.#.#.###.#.#.###.#####.#.#.#.#.#.#.#####.#.#####.#.#.#.#.#.#
#.#...#.#.....#...#.....#.#.#...#...#...#...#.#...#...#.....#.....#.......................#.#...#.....#.#.#...#.#.#.....#.#.#...#.....#.#.#.#
#.#######.#####.#.#####.#.#.#.#.###.#.#######.#.#.#.#.#########.###.###.#####.###.###.#.###.###.#####.#.#.#####.#.#.###.#.#.#.###.#####.#.#.#
#.......#.#.............#.#...#...#.#.#.#...#...#...#.........#...#.#...#.....#.#.#.#...#...............#.....#.....................#.......#
#######.#.#.#####.#######.###.###.#.#.#.#.#.#####.#.###.#####.#.###.#.#####.###.#.#.#.###.###.#####.#########.#.#####.###.#####.#.#.#.#.#####
#.#...#...#.#.......#.......#.#...#.#.#...#.......................#.#.......#.#...#.#...#...#.....#...#.........#.....#.......#.#...#.......#
#.#.#.#####.#.#.#####.#####.#.#.#.#.#.#####.#.#####.#.###.#.###.#.#.#########.#.###.#.#.###.#.###.###.#########.#.#########.#.#.#.#.###.###.#
#...#.....#.#.#...#...#.....#...#.#.#.#...#...#.....#.#.#...#...#.#.#.........#.......#...#.#...#...#.......#...#.#.......#.#.........#...#.#
#.#######.#.#.###.#.#.#######.###.#.#.#.#.#####.###.#.#.###.#.###.#.#.#######.#######.###.#.#######.#######.#####.#.#####.#######.###.#.#.#.#
#.#.....#...#...#.#.#.#...........#...#.#.........................#.#.....#.#.#.....#.#...#.......#...#.....#...#.....#.#...#.....#.......#.#
#.###.#.#########.#.###.#############.#.#####.###.#.#.#########.###.#####.#.#.#.#.###.#.#########.###.#.#####.#.#.###.#.###.#.###.#####.###.#
#S....#...........#.....................#.........#.............#...........#...#.....#...............#.......#.......#.......#.............#
#############################################################################################################################################`,
}
